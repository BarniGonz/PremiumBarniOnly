<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Chatbot with Puter.js</title>
  <script src="https://js.puter.com/v2/"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Light theme */
      --primary-color: #6b46c1;
      --primary-dark: #553c9a;
      --background-gradient-start: #e9d5ff;
      --background-gradient-end: #c4b5fd;
      --chat-bg: rgba(255, 255, 255, 0.9);
      --chat-border: rgba(255, 255, 255, 0.2);
      --user-bg: linear-gradient(135deg, #7c3aed, #4c1d95);
      --ai-bg: linear-gradient(135deg, #e2e8f0, #cbd5e1);
      --text-color: #1f2937;
      --border-color: #d1d5db;
      --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      --scrollbar-color: #6b46c1;
      --scrollbar-bg: #e5e7eb;
      --transition: all 0.3s ease;
      --blur: blur(8px);
      --gradient-colors: #ff6bcb, #6b46c1, #00c4ff, #ff6bcb;
    }
    
    :root[data-theme="dark"] {
      /* Dark theme */
      --primary-color: #a78bfa;
      --primary-dark: #7c3aed;
      --background-gradient-start: #1e1b4b;
      --background-gradient-end: #2e1065;
      --chat-bg: rgba(30, 41, 59, 0.9);
      --chat-border: rgba(255, 255, 255, 0.1);
      --user-bg: linear-gradient(135deg, #a78bfa, #7c3aed);
      --ai-bg: linear-gradient(135deg, #475569, #334155);
      --text-color: #e2e8f0;
      --border-color: #475569;
      --shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
      --scrollbar-color: #a78bfa;
      --scrollbar-bg: #1e293b;
      --gradient-colors: #ff6bcb, #a78bfa, #00c4ff, #ff6bcb;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, var(--background-gradient-start), var(--background-gradient-end));
      color: var(--text-color);
      min-height: 100vh;
      padding: 1rem;
      transition: var(--transition);
    }
    
    header {
      margin-bottom: 1rem;
      text-align: center;
      font-size: 1.125rem;
      font-weight: 500;
      padding: 0.5rem;
    }
    
    .app-container {
      width: 100%;
      max-width: min(90vw, 40rem);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    #controls-container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    
    #model-selector-container, #conversation-controls {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    
    #model-select, #conversation-select {
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      font-size: 0.9375rem;
      background-color: var(--chat-bg);
      color: var(--text-color);
      outline: none;
      cursor: pointer;
      transition: var(--transition);
      backdrop-filter: var(--blur);
      flex: 1;
      min-width: 120px;
    }
    
    #model-select:focus, #conversation-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0.625rem rgba(107, 70, 193, 0.3);
    }
    
    .theme-toggle, .conversation-controls {
      display: flex;
      align-items: center;
      gap: 0.625rem;
    }
    
    .theme-toggle-label, .conversation-controls button {
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
    }
    
    .theme-toggle-switch {
      position: relative;
      width: 3.5rem;
      height: 1.75rem;
    }
    
    .theme-toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .theme-toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border-color);
      border-radius: 1.75rem;
      transition: var(--transition);
      display: flex;
      align-items: center;
      padding: 0 0.25rem;
    }
    
    .theme-toggle-slider:before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='5'/%3E%3Cpath d='M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42'/%3E%3C/svg%3E");
      height: 1.5rem;
      width: 1.5rem;
      background-color: var(--chat-bg);
      border-radius: 50%;
      transition: var(--transition);
      transform: translateX(0);
    }
    
    .theme-toggle-switch input:checked + .theme-toggle-slider {
      background-color: var(--primary-color);
    }
    
    .theme-toggle-switch input:checked + .theme-toggle-slider:before {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z'/%3E%3C/svg%3E");
      transform: translateX(1.75rem);
    }
    
    .theme-toggle-switch input:focus + .theme-toggle-slider {
      box-shadow: 0 0 0.5rem var(--primary-color);
    }
    
    #new-conversation-btn, #delete-conversation-btn {
      padding: 0.625rem 1.25rem;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      transition: var(--transition);
      min-width: 80px;
    }
    
    #new-conversation-btn:hover, #delete-conversation-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-0.125rem);
    }
    
    #delete-conversation-btn:disabled {
      background: #6b7280;
      cursor: not-allowed;
      transform: none;
    }
    
    #chat-container {
      width: 100%;
      min-height: 20rem;
      max-height: 70vh;
      border: 1px solid var(--chat-border);
      border-radius: 0.75rem;
      background-color: var(--chat-bg);
      backdrop-filter: var(--blur);
      overflow-y: auto;
      padding: 1.25rem;
      box-shadow: var(--shadow);
      scrollbar-width: thin;
      scrollbar-color: var(--scrollbar-color) var(--scrollbar-bg);
      transition: var(--transition);
    }
    
    .message {
      margin: 0.75rem 0;
      padding: 0.75rem 1.125rem;
      border-radius: 0.75rem;
      max-width: 80%;
      word-wrap: break-word;
      animation: fadeIn 0.4s ease-in;
      position: relative;
      color: var(--text-color);
      transition: transform 0.2s ease;
      overflow: hidden; /* Prevent overflow */
    }
    
    .message:hover {
      transform: scale(1.02);
    }
    
    .message .timestamp {
      font-size: 0.75rem;
      color: var(--text-color);
      opacity: 0.7;
      margin-top: 0.5rem;
      text-align: right;
    }
    
    .user {
      background: var(--user-bg);
      color: white;
      margin-left: auto;
      text-align: right;
      box-shadow: var(--shadow);
    }
    
    .ai {
      background: var(--ai-bg);
      margin-right: auto;
      text-align: left;
      box-shadow: var(--shadow);
      padding-right: 1.125rem;
    }
    
    .message-content {
      white-space: pre-wrap;
      word-break: break-word;
      overflow-wrap: anywhere; /* Ensure long words wrap */
      max-width: 100%; /* Stay within container */
    }
    
    .code-block {
      position: relative;
      background-color: rgba(0, 0, 0, 0.1);
      padding: 1rem;
      border-radius: 0.5rem;
      margin: 0.5rem 0;
      font-family: monospace;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-wrap: anywhere; /* Ensure long words wrap */
      max-width: 100%; /* Stay within container */
      overflow: hidden; /* Prevent overflow */
    }
    
    .code-block pre {
      margin: 0;
      padding: 0;
      white-space: pre-wrap;
      word-break: break-word;
      overflow-wrap: anywhere; /* Ensure long words wrap */
      max-width: 100%; /* Stay within container */
    }
    
    .code-block code {
      display: block; /* Ensure code respects container width */
      white-space: pre-wrap;
      word-break: break-word;
      overflow-wrap: anywhere; /* Ensure long words wrap */
      max-width: 100%; /* Stay within container */
    }
    
    .copy-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 0.25rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      cursor: pointer;
      opacity: 0.8;
      transition: opacity 0.2s ease, background-color 0.2s ease;
      margin-top: 0.5rem;
      display: inline-block;
    }
    
    .copy-btn:hover {
      opacity: 1;
      background-color: var(--primary-dark);
    }
    
    .copy-btn.copied {
      background-color: #48bb78; /* Green color for success */
    }
    
    .typing-indicator {
      background: var(--ai-bg);
      margin-right: auto;
      padding: 0.75rem 1.125rem;
      border-radius: 0.75rem;
      max-width: 80%;
      animation: fadeIn 0.4s ease-in;
      box-shadow: var(--shadow);
    }
    
    .typing-indicator::after {
      content: 'Typing...';
      animation: blink 1s infinite;
    }
    
    #input-container {
      width: 100%;
      display: flex;
      gap: 0.75rem;
      padding: 0.625rem;
      background: var(--chat-bg);
      border-radius: 0.75rem;
      box-shadow: var(--shadow);
      backdrop-filter: var(--blur);
      transition: var(--transition);
    }
    
    #user-input {
      flex-grow: 1;
      padding: 0.75rem;
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      font-size: 0.9375rem;
      background-color: var(--chat-bg);
      color: var(--text-color);
      outline: none;
      transition: var(--transition);
    }
    
    #user-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0.75rem rgba(107, 70, 193, 0.4);
      transform: translateY(-0.125rem);
    }
    
    #send-btn {
      padding: 0.75rem 1.5rem;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 0.9375rem;
      font-weight: 500;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      min-width: 80px;
    }
    
    #send-btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.4s ease, height 0.4s ease;
    }
    
    #send-btn:hover::after {
      width: 12.5rem;
      height: 12.5rem;
    }
    
    #send-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-0.125rem);
    }
    
    #send-btn:disabled {
      background: #6b7280;
      cursor: not-allowed;
      transform: none;
    }
    
    footer {
      margin-top: 1rem;
      text-align: center;
      font-size: 1.125rem;
      font-weight: 500;
      padding: 0.5rem;
    }
    
    .powered-by, .contact-link {
      display: inline-block;
      background: linear-gradient(90deg, var(--gradient-colors));
      background-size: 200% 100%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: gradientShift 5s linear infinite;
      will-change: background-position;
      transition: transform 0.2s ease;
    }
    
    .contact-link {
      text-decoration: none;
    }
    
    .contact-link:hover {
      transform: scale(1.05);
    }
    
    @keyframes gradientShift {
      0% { background-position: 200% 0; }
      100% { background-position: 0 0; }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(0.625rem); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes blink {
      50% { opacity: 0.5; }
    }
    
    /* Responsive design */
    @media (max-width: 600px) {
      body {
        padding: 0.5rem;
      }
      .app-container {
        max-width: 95vw;
      }
      #model-selector-container, #conversation-controls {
        flex-direction: column;
        align-items: stretch;
      }
      #model-select, #conversation-select, #new-conversation-btn, #delete-conversation-btn {
        width: 100%;
      }
      #chat-container {
        min-height: 15rem;
        max-height: 60vh;
      }
      #user-input, #send-btn {
        font-size: 0.875rem;
      }
      header, footer {
        font-size: 0.875rem;
        padding: 0.25rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <span class="powered-by">POWERED BY BARNI</span>
  </header>
  <div class="app-container">
    <div id="controls-container">
      <div id="model-selector-container">
        <label for="model-select" class="theme-toggle-label">Choose AI Model:</label>
        <select id="model-select" aria-label="Select AI model"></select>
        <div class="theme-toggle">
          <label for="theme-toggle" class="theme-toggle-label">Toggle Theme</label>
          <div class="theme-toggle-switch">
            <input type="checkbox" id="theme-toggle" aria-label="Toggle between light and dark theme">
            <span class="theme-toggle-slider"></span>
          </div>
        </div>
      </div>
      <div id="conversation-controls">
        <label for="conversation-select" class="theme-toggle-label">Conversation:</label>
        <select id="conversation-select" aria-label="Select conversation"></select>
        <div class="conversation-controls">
          <button id="new-conversation-btn" aria-label="Start new conversation">New</button>
          <button id="delete-conversation-btn" aria-label="Delete current conversation">Delete</button>
        </div>
      </div>
    </div>
    <div id="chat-container"></div>
    <div id="input-container">
      <input type="text" id="user-input" placeholder="Type your message..." autocomplete="off" aria-label="Type your message">
      <button id="send-btn" aria-label="Send message">Send</button>
    </div>
  </div>
  <footer>
    <a href="mailto:barnigonzales43329@gmail.com" class="contact-link" aria-label="Contact via email">CONTACT</a>
  </footer>
  
  <script>
    // OpenRouter model list
    const openRouterModels = [
      "openrouter:01-ai/yi-large",
      "openrouter:aetherwiing/mn-starcannon-12b",
      "openrouter:agentica-org/deepcoder-14b-preview:free",
      "openrouter:ai21/jamba-1.6-large",
      "openrouter:ai21/jamba-1.6-mini",
      "openrouter:aion-labs/aion-1.0",
      "openrouter:aion-labs/aion-1.0-mini",
      "openrouter:aion-labs/aion-rp-llama-3.1-8b",
      "openrouter:alfredpros/codellama-7b-instruct-solidity",
      "openrouter:all-hands/openhands-lm-32b-v0.1",
      "openrouter:allenai/olmo-7b-instruct",
      "openrouter:alpindale/goliath-120b",
      "openrouter:alpindale/magnum-72b",
      "openrouter:amazon/nova-lite-v1",
      "openrouter:amazon/nova-micro-v1",
      "openrouter:amazon/nova-pro-v1",
      "openrouter:anthracite-org/magnum-v2-72b",
      "openrouter:anthracite-org/magnum-v4-72b",
      "openrouter:anthropic/claude-2",
      "openrouter:anthropic/claude-2.0",
      "openrouter:anthropic/claude-2.0:beta",
      "openrouter:anthropic/claude-2.1",
      "openrouter:anthropic/claude-2.1:beta",
      "openrouter:anthropic/claude-2:beta",
      "openrouter:anthropic/claude-3-haiku",
      "openrouter:anthropic/claude-3-haiku:beta",
      "openrouter:anthropic/claude-3-opus",
      "openrouter:anthropic/claude-3-opus:beta",
      "openrouter:anthropic/claude-3-sonnet",
      "openrouter:anthropic/claude-3-sonnet:beta",
      "openrouter:anthropic/claude-3.5-haiku",
      "openrouter:anthropic/claude-3.5-haiku-20241022",
      "openrouter:anthropic/claude-3.5-haiku-20241022:beta",
      "openrouter:anthropic/claude-3.5-haiku:beta",
      "openrouter:anthropic/claude-3.5-sonnet",
      "openrouter:anthropic/claude-3.5-sonnet-20240620",
      "openrouter:anthropic/claude-3.5-sonnet-20240620:beta",
      "openrouter:anthropic/claude-3.5-sonnet:beta",
      "openrouter:anthropic/claude-3.7-sonnet",
      "openrouter:anthropic/claude-3.7-sonnet:beta",
      "openrouter:anthropic/claude-3.7-sonnet:thinking",
      "openrouter:anthropic/claude-opus-4",
      "openrouter:anthropic/claude-sonnet-4",
      "openrouter:arcee-ai/arcee-blitz",
      "openrouter:arcee-ai/caller-large",
      "openrouter:arcee-ai/coder-large",
      "openrouter:arcee-ai/maestro-reasoning",
      "openrouter:arcee-ai/spotlight",
      "openrouter:arcee-ai/virtuoso-large",
      "openrouter:arcee-ai/virtuoso-medium-v2",
      "openrouter:arliai/qwq-32b-arliai-rpr-v1:free",
      "openrouter:cognitivecomputations/dolphin-mixtral-8x22b",
      "openrouter:cognitivecomputations/dolphin3.0-mistral-24b:free",
      "openrouter:cognitivecomputations/dolphin3.0-r1-mistral-24b:free",
      "openrouter:cohere/command",
      "openrouter:cohere/command-a",
      "openrouter:cohere/command-r",
      "openrouter:cohere/command-r-03-2024",
      "openrouter:cohere/command-r-08-2024",
      "openrouter:cohere/command-r-plus",
      "openrouter:cohere/command-r-plus-04-2024",
      "openrouter:cohere/command-r-plus-08-2024",
      "openrouter:cohere/command-r7b-12-2024",
      "openrouter:deepseek/deepseek-chat",
      "openrouter:deepseek/deepseek-chat-v3-0324",
      "openrouter:deepseek/deepseek-chat-v3-0324:free",
      "openrouter:deepseek/deepseek-chat:free",
      "openrouter:deepseek/deepseek-coder",
      "openrouter:deepseek/deepseek-prover-v2",
      "openrouter:deepseek/deepseek-prover-v2:free",
      "openrouter:deepseek/deepseek-r1",
      "openrouter:deepseek/deepseek-r1-distill-llama-70b",
      "openrouter:deepseek/deepseek-r1-distill-llama-70b:free",
      "openrouter:deepseek/deepseek-r1-distill-llama-8b",
      "openrouter:deepseek/deepseek-r1-distill-qwen-1.5b",
      "openrouter:deepseek/deepseek-r1-distill-qwen-14b",
      "openrouter:deepseek/deepseek-r1-distill-qwen-14b:free",
      "openrouter:deepseek/deepseek-r1-distill-qwen-32b",
      "openrouter:deepseek/deepseek-r1-distill-qwen-32b:free",
      "openrouter:deepseek/deepseek-r1-zero:free",
      "openrouter:deepseek/deepseek-r1:free",
      "openrouter:deepseek/deepseek-v3-base:free",
      "openrouter:eleutherai/llemma_7b",
      "openrouter:eva-unit-01/eva-llama-3.33-70b",
      "openrouter:eva-unit-01/eva-qwen-2.5-32b",
      "openrouter:eva-unit-01/eva-qwen-2.5-72b",
      "openrouter:featherless/qwerky-72b:free",
      "openrouter:google/gemini-2.0-flash-001",
      "openrouter:google/gemini-2.0-flash-exp:free",
      "openrouter:google/gemini-2.0-flash-lite-001",
      "openrouter:google/gemini-2.5-flash-preview",
      "openrouter:google/gemini-2.5-flash-preview-05-20",
      "openrouter:google/gemini-2.5-flash-preview-05-20:thinking",
      "openrouter:google/gemini-2.5-flash-preview:thinking",
      "openrouter:google/gemini-2.5-pro-exp-03-25",
      "openrouter:google/gemini-2.5-pro-preview",
      "openrouter:google/gemini-flash-1.5",
      "openrouter:google/gemini-flash-1.5-8b",
      "openrouter:google/gemini-pro-1.5",
      "openrouter:google/gemma-2-27b-it",
      "openrouter:google/gemma-2-9b-it",
      "openrouter:google/gemma-2-9b-it:free",
      "openrouter:google/gemma-3-12b-it",
      "openrouter:google/gemma-3-12b-it:free",
      "openrouter:google/gemma-3-1b-it:free",
      "openrouter:google/gemma-3-27b-it",
      "openrouter:google/gemma-3-27b-it:free",
      "openrouter:google/gemma-3-4b-it",
      "openrouter:google/gemma-3-4b-it:free",
      "openrouter:google/gemma-3n-e4b-it:free",
      "openrouter:gryphe/mythomax-l2-13b",
      "openrouter:inception/mercury-coder-small-beta",
      "openrouter:infermatic/mn-inferor-12b",
      "openrouter:inflection/inflection-3-pi",
      "openrouter:inflection/inflection-3-productivity",
      "openrouter:liquid/lfm-3b",
      "openrouter:liquid/lfm-40b",
      "openrouter:liquid/lfm-7b",
      "openrouter:mancer/weaver",
      "openrouter:meta-llama/llama-2-70b-chat",
      "openrouter:meta-llama/llama-3-70b-instruct",
      "openrouter:meta-llama/llama-3-8b-instruct",
      "openrouter:meta-llama/llama-3.1-405b",
      "openrouter:meta-llama/llama-3.1-405b-instruct",
      "openrouter:meta-llama/llama-3.1-405b:free",
      "openrouter:meta-llama/llama-3.1-70b-instruct",
      "openrouter:meta-llama/llama-3.1-8b-instruct",
      "openrouter:meta-llama/llama-3.1-8b-instruct:free",
      "openrouter:meta-llama/llama-3.2-11b-vision-instruct",
      "openrouter:meta-llama/llama-3.2-11b-vision-instruct:free",
      "openrouter:meta-llama/llama-3.2-1b-instruct",
      "openrouter:meta-llama/llama-3.2-1b-instruct:free",
      "openrouter:meta-llama/llama-3.2-3b-instruct",
      "openrouter:meta-llama/llama-3.2-3b-instruct:free",
      "openrouter:meta-llama/llama-3.2-90b-vision-instruct",
      "openrouter:meta-llama/llama-3.3-70b-instruct",
      "openrouter:meta-llama/llama-3.3-70b-instruct:free",
      "openrouter:meta-llama/llama-3.3-8b-instruct:free",
      "openrouter:meta-llama/llama-4-maverick",
      "openrouter:meta-llama/llama-4-maverick:free",
      "openrouter:meta-llama/llama-4-scout",
      "openrouter:meta-llama/llama-4-scout:free",
      "openrouter:meta-llama/llama-guard-2-8b",
      "openrouter:meta-llama/llama-guard-3-8b",
      "openrouter:meta-llama/llama-guard-4-12b",
      "openrouter:microsoft/mai-ds-r1:free",
      "openrouter:microsoft/phi-3-medium-128k-instruct",
      "openrouter:microsoft/phi-3-mini-128k-instruct",
      "openrouter:microsoft/phi-3.5-mini-128k-instruct",
      "openrouter:microsoft/phi-4",
      "openrouter:microsoft/phi-4-multimodal-instruct",
      "openrouter:microsoft/phi-4-reasoning-plus",
      "openrouter:microsoft/phi-4-reasoning-plus:free",
      "openrouter:microsoft/phi-4-reasoning:free",
      "openrouter:microsoft/wizardlm-2-8x22b",
      "openrouter:minimax/minimax-01",
      "openrouter:mistralai/codestral-2501",
      "openrouter:mistralai/codestral-mamba",
      "openrouter:mistralai/devstral-small",
      "openrouter:mistralai/devstral-small:free",
      "openrouter:mistralai/ministral-3b",
      "openrouter:mistralai/ministral-8b",
      "openrouter:mistralai/mistral-7b-instruct",
      "openrouter:mistralai/mistral-7b-instruct-v0.1",
      "openrouter:mistralai/mistral-7b-instruct-v0.2",
      "openrouter:mistralai/mistral-7b-instruct-v0.3",
      "openrouter:mistralai/mistral-7b-instruct:free",
      "openrouter:mistralai/mistral-large",
      "openrouter:mistralai/mistral-large-2407",
      "openrouter:mistralai/mistral-large-2411",
      "openrouter:mistralai/mistral-medium",
      "openrouter:mistralai/mistral-medium-3",
      "openrouter:mistralai/mistral-nemo",
      "openrouter:mistralai/mistral-nemo:free",
      "openrouter:mistralai/mistral-saba",
      "openrouter:mistralai/mistral-small",
      "openrouter:mistralai/mistral-small-24b-instruct-2501",
      "openrouter:mistralai/mistral-small-24b-instruct-2501:free",
      "openrouter:mistralai/mistral-small-3.1-24b-instruct",
      "openrouter:mistralai/mistral-small-3.1-24b-instruct:free",
      "openrouter:mistralai/mistral-tiny",
      "openrouter:mistralai/mixtral-8x22b-instruct",
      "openrouter:mistralai/mixtral-8x7b-instruct",
      "openrouter:mistralai/pixtral-12b",
      "openrouter:mistralai/pixtral-large-2411",
      "openrouter:moonshotai/kimi-vl-a3b-thinking:free",
      "openrouter:moonshotai/moonlight-16b-a3b-instruct:free",
      "openrouter:neversleep/llama-3-lumimaid-70b",
      "openrouter:neversleep/llama-3-lumimaid-8b",
      "openrouter:neversleep/llama-3-lumimaid-8b:extended",
      "openrouter:neversleep/llama-3.1-lumimaid-70b",
      "openrouter:neversleep/llama-3.1-lumimaid-8b",
      "openrouter:neversleep/noromaid-20b",
      "openrouter:nothingiisreal/mn-celeste-12b",
      "openrouter:nousresearch/deephermes-3-llama-3-8b-preview:free",
      "openrouter:nousresearch/deephermes-3-mistral-24b-preview:free",
      "openrouter:nousresearch/hermes-2-pro-llama-3-8b",
      "openrouter:nousresearch/hermes-3-llama-3.1-405b",
      "openrouter:nousresearch/hermes-3-llama-3.1-70b",
      "openrouter:nousresearch/nous-hermes-2-mixtral-8x7b-dpo",
      "openrouter:nvidia/llama-3.1-nemotron-70b-instruct",
      "openrouter:nvidia/llama-3.1-nemotron-ultra-253b-v1:free",
      "openrouter:nvidia/llama-3.3-nemotron-super-49b-v1",
      "openrouter:nvidia/llama-3.3-nemotron-super-49b-v1:free",
      "openrouter:open-r1/olympiccoder-32b:free",
      "openrouter:openai/chatgpt-4o-latest",
      "openrouter:openai/codex-mini",
      "openrouter:openai/gpt-3.5-turbo",
      "openrouter:openai/gpt-3.5-turbo-0125",
      "openrouter:openai/gpt-3.5-turbo-0613",
      "openrouter:openai/gpt-3.5-turbo-1106",
      "openrouter:openai/gpt-3.5-turbo-16k",
      "openrouter:openai/gpt-3.5-turbo-instruct",
      "openrouter:openai/gpt-4",
      "openrouter:openai/gpt-4-0314",
      "openrouter:openai/gpt-4-1106-preview",
      "openrouter:openai/gpt-4-32k",
      "openrouter:openai/gpt-4-32k-0314",
      "openrouter:openai/gpt-4-turbo",
      "openrouter:openai/gpt-4-turbo-preview",
      "openrouter:openai/gpt-4.1",
      "openrouter:openai/gpt-4.1-mini",
      "openrouter:openai/gpt-4.1-nano",
      "openrouter:openai/gpt-4.5-preview",
      "openrouter:openai/gpt-4o",
      "openrouter:openai/gpt-4o-2024-05-13",
      "openrouter:openai/gpt-4o-2024-08-06",
      "openrouter:openai/gpt-4o-2024-11-20",
      "openrouter:openai/gpt-4o-mini",
      "openrouter:openai/gpt-4o-mini-2024-07-18",
      "openrouter:openai/gpt-4o-mini-search-preview",
      "openrouter:openai/gpt-4o-search-preview",
      "openrouter:openai/gpt-4o:extended",
      "openrouter:openai/o1",
      "openrouter:openai/o1-mini",
      "openrouter:openai/o1-mini-2024-09-12",
      "openrouter:openai/o1-preview",
      "openrouter:openai/o1-preview-2024-09-12",
      "openrouter:openai/o1-pro",
      "openrouter:openai/o3",
      "openrouter:openai/o3-mini",
      "openrouter:openai/o3-mini-high",
      "openrouter:openai/o4-mini",
      "openrouter:openai/o4-mini-high",
      "openrouter:opengvlab/internvl3-14b:free",
      "openrouter:opengvlab/internvl3-2b:free",
      "openrouter:openrouter/auto",
      "openrouter:perplexity/llama-3.1-sonar-large-128k-online",
      "openrouter:perplexity/llama-3.1-sonar-small-128k-online",
      "openrouter:perplexity/r1-1776",
      "openrouter:perplexity/sonar",
      "openrouter:perplexity/sonar-deep-research",
      "openrouter:perplexity/sonar-pro",
      "openrouter:perplexity/sonar-reasoning",
      "openrouter:perplexity/sonar-reasoning-pro",
      "openrouter:pygmalionai/mythalion-13b",
      "openrouter:qwen/qwen-2-72b-instruct",
      "openrouter:qwen/qwen-2.5-72b-instruct",
      "openrouter:qwen/qwen-2.5-72b-instruct:free",
      "openrouter:qwen/qwen-2.5-7b-instruct",
      "openrouter:qwen/qwen-2.5-7b-instruct:free",
      "openrouter:qwen/qwen-2.5-coder-32b-instruct",
      "openrouter:qwen/qwen-2.5-coder-32b-instruct:free",
      "openrouter:qwen/qwen-2.5-vl-7b-instruct",
      "openrouter:qwen/qwen-2.5-vl-7b-instruct:free",
      "openrouter:qwen/qwen-max",
      "openrouter:qwen/qwen-plus",
      "openrouter:qwen/qwen-turbo",
      "openrouter:qwen/qwen-vl-max",
      "openrouter:qwen/qwen-vl-plus",
      "openrouter:qwen/qwen2.5-coder-7b-instruct",
      "openrouter:qwen/qwen2.5-vl-32b-instruct",
      "openrouter:qwen/qwen2.5-vl-32b-instruct:free",
      "openrouter:qwen/qwen2.5-vl-3b-instruct:free",
      "openrouter:qwen/qwen2.5-vl-72b-instruct",
      "openrouter:qwen/qwen2.5-vl-72b-instruct:free",
      "openrouter:qwen/qwen3-14b",
      "openrouter:qwen/qwen3-14b:free",
      "openrouter:qwen/qwen3-235b-a22b",
      "openrouter:qwen/qwen3-235b-a22b:free",
      "openrouter:qwen/qwen3-30b-a3b",
      "openrouter:qwen/qwen3-30b-a3b:free",
      "openrouter:qwen/qwen3-32b",
      "openrouter:qwen/qwen3-32b:free",
      "openrouter:qwen/qwen3-8b",
      "openrouter:qwen/qwen3-8b:free",
      "openrouter:qwen/qwq-32b",
      "openrouter:qwen/qwq-32b-preview",
      "openrouter:qwen/qwq-32b:free",
      "openrouter:raifle/sorcererlm-8x22b",
      "openrouter:rekaai/reka-flash-3:free",
      "openrouter:sao10k/fimbulvetr-11b-v2",
      "openrouter:sao10k/l3-euryale-70b",
      "openrouter:sao10k/l3-lunaris-8b",
      "openrouter:sao10k/l3.1-euryale-70b",
      "openrouter:sao10k/l3.3-euryale-70b",
      "openrouter:scb10x/llama3.1-typhoon2-70b-instruct",
      "openrouter:scb10x/llama3.1-typhoon2-8b-instruct",
      "openrouter:shisa-ai/shisa-v2-llama3.3-70b:free",
      "openrouter:sophosympatheia/midnight-rose-70b",
      "openrouter:thedrummer/anubis-pro-105b-v1",
      "openrouter:thedrummer/rocinante-12b",
      "openrouter:thedrummer/skyfall-36b-v2",
      "openrouter:thedrummer/unslopnemo-12b",
      "openrouter:thedrummer/valkyrie-49b-v1",
      "openrouter:thudm/glm-4-32b",
      "openrouter:thudm/glm-4-32b:free",
      "openrouter:thudm/glm-z1-32b",
      "openrouter:thudm/glm-z1-32b:free",
      "openrouter:thudm/glm-z1-rumination-32b",
      "openrouter:tngtech/deepseek-r1t-chimera:free",
      "openrouter:undi95/remm-slerp-l2-13b",
      "openrouter:undi95/toppy-m-7b",
      "openrouter:x-ai/grok-2-1212",
      "openrouter:x-ai/grok-2-vision-1212",
      "openrouter:x-ai/grok-3-beta",
      "openrouter:x-ai/grok-3-mini-beta",
      "openrouter:x-ai/grok-beta",
      "openrouter:x-ai/grok-vision-beta"
    ];
    
    // Theme management
    const themeToggle = document.getElementById('theme-toggle');
    const htmlElement = document.documentElement;
    
    function loadTheme() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      htmlElement.setAttribute('data-theme', savedTheme);
      themeToggle.checked = savedTheme === 'dark';
    }
    
    function toggleTheme() {
      const currentTheme = htmlElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      htmlElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    }
    
    loadTheme();
    themeToggle.addEventListener('change', toggleTheme);
    
    // Chat functionality
    const chatContainer = document.getElementById('chat-container');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const modelSelect = document.getElementById('model-select');
    const conversationSelect = document.getElementById('conversation-select');
    const newConversationBtn = document.getElementById('new-conversation-btn');
    const deleteConversationBtn = document.getElementById('delete-conversation-btn');
    
    // Populate model selector
    function populateModelSelector() {
      modelSelect.innerHTML = '';
      const defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.textContent = 'Select a model';
      defaultOption.disabled = true;
      defaultOption.selected = true;
      modelSelect.appendChild(defaultOption);
      
      openRouterModels.forEach(modelId => {
        const option = document.createElement('option');
        option.value = modelId;
        option.textContent = modelId.replace(/^openrouter:/, '');
        modelSelect.appendChild(option);
      });
    }
    
    // Conversation management
    let conversations = {};
    let currentConversationId = null;
    
    // Check for localStorage availability
    function isLocalStorageAvailable() {
      try {
        const test = '__test__';
        localStorage.setItem(test, test);
        localStorage.removeItem(test);
        return true;
      } catch (e) {
        console.warn('localStorage not available, using in-memory storage');
        return false;
      }
    }
    
    const useLocalStorage = isLocalStorageAvailable();
    
    // Load conversations from localStorage
    function loadConversations() {
      if (useLocalStorage) {
        const saved = localStorage.getItem('conversations');
        conversations = saved ? JSON.parse(saved) : {};
      }
      if (Object.keys(conversations).length === 0) {
        createNewConversation();
      } else {
        currentConversationId = Object.keys(conversations)[0];
        updateConversationSelect();
        renderMessages();
      }
    }
    
    // Save conversations to localStorage with debounce
    let saveTimeout = null;
    function saveConversations() {
      if (!useLocalStorage) return;
      clearTimeout(saveTimeout);
      saveTimeout = setTimeout(() => {
        try {
          localStorage.setItem('conversations', JSON.stringify(conversations));
        } catch (e) {
          console.error('Failed to save conversations:', e);
          appendMessage('Warning: Unable to save chat history. Storage may be full.', 'ai', false, false);
        }
      }, 500);
    }
    
    // Create a new conversation
    function createNewConversation() {
      const id = `conv_${Date.now()}_${Math.random().toString(36).slice(2, 9)}`;
      conversations[id] = [];
      currentConversationId = id;
      updateConversationSelect();
      renderMessages();
      appendMessage('Welcome! Start a new conversation.', 'ai', false, false);
      saveConversations();
    }
    
    // Delete current conversation
    function deleteConversation() {
      if (!currentConversationId || Object.keys(conversations).length <= 1) {
        appendMessage('Cannot delete the last conversation.', 'ai', false, false);
        return;
      }
      delete conversations[currentConversationId];
      currentConversationId = Object.keys(conversations)[0];
      updateConversationSelect();
      renderMessages();
      saveConversations();
    }
    
    // Update conversation selector
    function updateConversationSelect() {
      conversationSelect.innerHTML = '';
      Object.keys(conversations).forEach(id => {
        const option = document.createElement('option');
        option.value = id;
        option.textContent = `Conversation ${id.slice(5, 12)}`;
        conversationSelect.appendChild(option);
      });
      conversationSelect.value = currentConversationId;
      deleteConversationBtn.disabled = Object.keys(conversations).length <= 1;
    }
    
    // Render messages for current conversation
    function renderMessages() {
      chatContainer.innerHTML = '';
      const messages = conversations[currentConversationId] || [];
      messages.forEach(msg => {
        appendMessage(msg.content, msg.role, false, msg.role === 'user');
      });
    }
    
    // Format timestamp
    function formatTimestamp() {
      const now = new Date();
      return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    
    // Append message to chat container
    function appendMessage(text, className, isTyping = false, showTimestamp = true) {
      const msgDiv = document.createElement('div');
      msgDiv.className = `message ${className}${isTyping ? ' typing-indicator' : ''}`;
      
      if (!isTyping) {
        if (className === 'ai') {
          // Handle AI message with pre and copy button
          const contentDiv = document.createElement('div');
          contentDiv.className = 'code-block';
          const pre = document.createElement('pre');
          const code = document.createElement('code');
          // Split content into regular text and code blocks
          const parts = text.split(/(```[\s\S]*?```)/g).filter(Boolean);
          parts.forEach(part => {
            if (part.match(/```[\s\S]*```/)) {
              // Handle code block
              const codeContent = part.replace(/^```[\s\S]*?\n|\n```$/g, '');
              const codeElement = document.createElement('code');
              codeElement.textContent = codeContent;
              pre.appendChild(codeElement);
            } else {
              // Handle regular text
              const textNode = document.createTextNode(part);
              pre.appendChild(textNode);
            }
          });
          contentDiv.appendChild(pre);
          
          // Add copy button for AI message
          const copyBtn = document.createElement('button');
          copyBtn.className = 'copy-btn';
          copyBtn.textContent = 'Copy';
          copyBtn.setAttribute('aria-label', 'Copy AI response to clipboard');
          copyBtn.onclick = (e) => {
            e.stopPropagation();
            navigator.clipboard.writeText(text).then(() => {
              copyBtn.textContent = 'Copied!';
              copyBtn.classList.add('copied');
              setTimeout(() => {
                copyBtn.textContent = 'Copy';
                copyBtn.classList.remove('copied');
              }, 2000);
            }).catch(err => {
              console.error('Failed to copy AI response: ', err);
              copyBtn.textContent = 'Failed!';
              setTimeout(() => {
                copyBtn.textContent = 'Copy';
              }, 2000);
            });
          };
          contentDiv.appendChild(copyBtn);
          msgDiv.appendChild(contentDiv);
        } else {
          // Handle user message
          const contentDiv = document.createElement('div');
          contentDiv.className = 'message-content';
          contentDiv.textContent = text;
          msgDiv.appendChild(contentDiv);
          
          if (showTimestamp && className === 'user') {
            const timestamp = document.createElement('div');
            timestamp.className = 'timestamp';
            timestamp.textContent = formatTimestamp();
            msgDiv.appendChild(timestamp);
          }
        }
      }
      
      chatContainer.appendChild(msgDiv);
      requestAnimationFrame(() => {
        chatContainer.scrollTop = chatContainer.scrollHeight;
      });
      return msgDiv;
    }
    
    // Stream AI response with conversation context
    async function streamAIResponse(prompt) {
      try {
        if (!prompt) throw new Error('Empty input');
        if (!currentConversationId) throw new Error('No conversation selected');
        if (!modelSelect.value) throw new Error('No model selected');
        
        userInput.disabled = true;
        sendBtn.disabled = true;
        const userMessage = { role: 'user', content: prompt, timestamp: formatTimestamp() };
        conversations[currentConversationId].push(userMessage);
        appendMessage(prompt, 'user', false, true);
        saveConversations();
        
        const typingDiv = appendMessage('', 'ai', true, false);
        const selectedModel = modelSelect.value;
        const history = conversations[currentConversationId].map(msg => ({
          role: msg.role,
          content: msg.content
        }));
        const response = await puter.ai.chat(prompt, { model: selectedModel, stream: true, history });
        typingDiv.remove();
        const aiMsgDiv = appendMessage('', 'ai', false, false);
        let fullResponse = '';
        
        for await (const part of response) {
          if (part?.text) {
            fullResponse += part.text;
            aiMsgDiv.innerHTML = ''; // Clear previous content
            const contentDiv = document.createElement('div');
            contentDiv.className = 'code-block';
            const pre = document.createElement('pre');
            const code = document.createElement('code');
            // Split content into regular text and code blocks for streaming
            const parts = fullResponse.split(/(```[\s\S]*?```)/g).filter(Boolean);
            parts.forEach(part => {
              if (part.match(/```[\s\S]*```/)) {
                // Handle code block
                const codeContent = part.replace(/^```[\s\S]*?\n|\n```$/g, '');
                const codeElement = document.createElement('code');
                codeElement.textContent = codeContent;
                pre.appendChild(codeElement);
              } else {
                // Handle regular text
                const textNode = document.createTextNode(part);
                pre.appendChild(textNode);
              }
            });
            contentDiv.appendChild(pre);
            
            // Add copy button for streaming AI response
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.setAttribute('aria-label', 'Copy AI response to clipboard');
            copyBtn.onclick = (e) => {
              e.stopPropagation();
              navigator.clipboard.writeText(fullResponse).then(() => {
                copyBtn.textContent = 'Copied!';
                copyBtn.classList.add('copied');
                setTimeout(() => {
                  copyBtn.textContent = 'Copy';
                  copyBtn.classList.remove('copied');
                }, 2000);
              }).catch(err => {
                console.error('Failed to copy AI response: ', err);
                copyBtn.textContent = 'Failed!';
                setTimeout(() => {
                  copyBtn.textContent = 'Copy';
                }, 2000);
              });
            };
            contentDiv.appendChild(copyBtn);
            aiMsgDiv.appendChild(contentDiv);
            
            requestAnimationFrame(() => {
              chatContainer.scrollTop = chatContainer.scrollHeight;
            });
          }
        }
        conversations[currentConversationId].push({ role: 'ai', content: fullResponse, timestamp: formatTimestamp() });
        saveConversations();
      } catch (error) {
        console.error('Error:', error);
        appendMessage('Sorry, an error occurred. Please try again.', 'ai', false, false);
      } finally {
        userInput.disabled = false;
        sendBtn.disabled = false;
        userInput.focus();
      }
    }
    
    // Handle send action
    function handleSend() {
      const text = userInput.value.trim();
      if (text) {
        streamAIResponse(text);
        userInput.value = '';
      }
    }
    
    // Event listeners
    sendBtn.onclick = handleSend;
    userInput.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !sendBtn.disabled) {
        handleSend();
      }
    });
    newConversationBtn.onclick = createNewConversation;
    deleteConversationBtn.onclick = deleteConversation;
    conversationSelect.onchange = () => {
      currentConversationId = conversationSelect.value;
      renderMessages();
    };
    
    // Initialize
    populateModelSelector();
    loadConversations();
    userInput.focus();
  </script>
</body>
</html>